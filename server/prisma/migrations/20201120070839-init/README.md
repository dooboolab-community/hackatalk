# Migration `20201120070839-init`

This migration has been generated by hyochan at 11/20/2020, 4:08:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "hackatalk"."Gender" AS ENUM ('male', 'female')

CREATE TYPE "hackatalk"."AuthType" AS ENUM ('email', 'facebook', 'google', 'apple')

CREATE TYPE "hackatalk"."MembershipType" AS ENUM ('owner', 'admin', 'member')

CREATE TYPE "hackatalk"."AlertMode" AS ENUM ('sound', 'vibrate', 'silent')

CREATE TYPE "hackatalk"."ChannelType" AS ENUM ('private', 'public')

CREATE TYPE "hackatalk"."MessageType" AS ENUM ('text', 'photo', 'file')

CREATE TABLE "hackatalk"."User" (
"id" text   NOT NULL ,
"email" text   ,
"password" text   ,
"name" text   ,
"nickname" text   ,
"thumbURL" text   ,
"photoURL" text   ,
"birthday" timestamp(3)   ,
"gender" "Gender"  ,
"phone" text   ,
"statusMessage" text   ,
"verified" boolean   DEFAULT false,
"lastSignedIn" timestamp(3)   ,
"isOnline" boolean   DEFAULT false,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "hackatalk"."Notification" (
"id" SERIAL,
"token" text   NOT NULL ,
"device" text   ,
"os" text   ,
"userId" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "hackatalk"."Profile" (
"id" SERIAL,
"socialId" text   ,
"authType" "AuthType"  ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "hackatalk"."Friend" (
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
"userId" text   NOT NULL ,
"friendId" text   NOT NULL ,
PRIMARY KEY ("userId","friendId")
)

CREATE TABLE "hackatalk"."BlockedUser" (
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
"userId" text   NOT NULL ,
"blockedUserId" text   NOT NULL ,
PRIMARY KEY ("userId","blockedUserId")
)

CREATE TABLE "hackatalk"."Report" (
"report" text   NOT NULL ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
"userId" text   NOT NULL ,
"reportedUserId" text   NOT NULL ,
PRIMARY KEY ("userId","reportedUserId")
)

CREATE TABLE "hackatalk"."Membership" (
"alertMode" "AlertMode"  DEFAULT E'sound',
"membershipType" "MembershipType"  NOT NULL DEFAULT E'member',
"isVisible" boolean   NOT NULL DEFAULT true,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"userId" text   NOT NULL ,
"channelId" text   NOT NULL ,
PRIMARY KEY ("userId","channelId")
)

CREATE TABLE "hackatalk"."Channel" (
"id" text   NOT NULL ,
"channelType" "ChannelType"  NOT NULL ,
"name" text   ,
"lastMessageId" text   ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "hackatalk"."Message" (
"id" text   NOT NULL ,
"messageType" "MessageType"  NOT NULL DEFAULT E'text',
"text" text   ,
"imageUrls" text []  ,
"fileUrls" text []  ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
"channelId" text   NOT NULL ,
"senderId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "hackatalk"."Reply" (
"id" SERIAL,
"messageType" "MessageType"  NOT NULL DEFAULT E'text',
"text" text   ,
"imageUrls" text []  ,
"fileUrls" text []  ,
"createdAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
"senderId" text   NOT NULL ,
"messageId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "hackatalk"."Reaction" (
"id" SERIAL,
"value" text   NOT NULL ,
"userId" text   NOT NULL ,
"messageId" text   NOT NULL ,
"replyId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "hackatalk"."User"("email")

CREATE UNIQUE INDEX "Notification.token_unique" ON "hackatalk"."Notification"("token")

CREATE UNIQUE INDEX "Profile.userId_unique" ON "hackatalk"."Profile"("userId")

ALTER TABLE "hackatalk"."Notification" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Notification" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Profile" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Friend" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Friend" ADD FOREIGN KEY("friendId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."BlockedUser" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."BlockedUser" ADD FOREIGN KEY("blockedUserId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Report" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Report" ADD FOREIGN KEY("reportedUserId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Membership" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Membership" ADD FOREIGN KEY("channelId")REFERENCES "hackatalk"."Channel"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Membership" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Message" ADD FOREIGN KEY("channelId")REFERENCES "hackatalk"."Channel"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Message" ADD FOREIGN KEY("senderId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Message" ADD FOREIGN KEY("channelId")REFERENCES "hackatalk"."Channel"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Reply" ADD FOREIGN KEY("senderId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Reply" ADD FOREIGN KEY("messageId")REFERENCES "hackatalk"."Message"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Reply" ADD FOREIGN KEY("messageId")REFERENCES "hackatalk"."Message"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Reaction" ADD FOREIGN KEY("userId")REFERENCES "hackatalk"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Reaction" ADD FOREIGN KEY("messageId")REFERENCES "hackatalk"."Message"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "hackatalk"."Reaction" ADD FOREIGN KEY("replyId")REFERENCES "hackatalk"."Reply"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201120070839-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,203 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+enum Gender {
+  male
+  female
+}
+
+enum AuthType {
+  email
+  facebook
+  google
+  apple
+}
+
+model User {
+  id                     String                  @default(cuid()) @id
+  email                  String?                 @unique
+  password               String?
+  name                   String?
+  nickname               String?
+  thumbURL               String?
+  photoURL               String?
+  birthday               DateTime?
+  gender                 Gender?
+  phone                  String?
+  statusMessage          String?
+  verified               Boolean?                @default(false)
+  lastSignedIn           DateTime?
+  isOnline               Boolean?                @default(false)
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+
+  profile                Profile?
+  notifications          Notification[]          @relation("Notification")
+  friends                Friend[]                @relation("Friend")
+  memberships            Membership[]            @relation("Membership")
+  blockedUsers           BlockedUser[]           @relation("BlockedUser")
+  reports                Report[]                @relation("Report")
+}
+
+model Notification {
+  id                     Int                     @default(autoincrement()) @id
+  token                  String                  @unique
+  device                 String?
+  os                     String?
+  userId                 String
+  user                   User                    @relation(fields: [userId], references: [id])
+  createdAt              DateTime?               @default(now())
+}
+
+model Profile {
+  id                     Int                     @default(autoincrement()) @id
+  socialId               String?
+  authType               AuthType?
+
+  userId                 String                  @unique
+  User                   User                    @relation(fields: [userId], references: [id])
+}
+
+model Friend {
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+
+  userId                 String
+  user                   User                    @relation(fields: [userId], references: [id])
+  friendId               String
+  friend                 User                    @relation(name: "Friend", fields: [friendId], references: [id])
+
+  @@id([userId, friendId])
+}
+
+model BlockedUser {
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+
+  userId                 String
+  user                   User                    @relation(fields: [userId], references: [id])
+  blockedUserId          String
+  blockedUser            User                    @relation(name: "BlockedUser", fields: [blockedUserId], references: [id])
+
+  @@id([userId, blockedUserId])
+}
+
+model Report {
+  report                 String
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+
+  userId                 String
+  user                   User                    @relation(fields: [userId], references: [id])
+  reportedUserId         String
+  reportedUser           User                    @relation(name: "Report", fields: [reportedUserId], references: [id])
+
+  @@id([userId, reportedUserId])
+}
+
+enum MembershipType {
+  owner
+  admin
+  member
+}
+
+enum AlertMode {
+  sound
+  vibrate
+  silent
+}
+
+model Membership {
+  alertMode              AlertMode?              @default(sound)
+  membershipType         MembershipType          @default(member)
+  isVisible              Boolean                 @default(true)
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+
+  userId                 String
+  user                   User                    @relation(fields: [userId], references: [id])
+  channelId              String
+  channel                Channel                 @relation(fields: [channelId], references: [id])
+
+  @@id([userId, channelId])
+}
+
+enum ChannelType {
+  private
+  public
+}
+
+model Channel {
+  id                     String                  @default(cuid()) @id
+  channelType            ChannelType
+  name                   String?
+  messages               Message[]               @relation("Message")
+  membership             Membership[]
+  lastMessageId          String?
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+}
+
+enum MessageType {
+  text
+  photo
+  file
+}
+
+model Message {
+  id                     String                  @default(cuid()) @id
+  messageType            MessageType             @default(text)
+  text                   String?
+  imageUrls              String[]
+  fileUrls               String[]
+  reactions              Reaction[]
+
+  replies                Reply[]                 @relation("Reply")
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+
+  channelId              String
+  channel                Channel                 @relation(fields: [channelId], references: [id])
+  senderId               String
+  sender                 User                    @relation(fields: [senderId], references: [id])
+}
+
+model Reply {
+  id                     Int                     @default(autoincrement()) @id
+  messageType            MessageType             @default(text)
+  text                   String?
+  imageUrls              String[]
+  fileUrls               String[]
+  reactions              Reaction[]
+  createdAt              DateTime?               @default(now())
+  updatedAt              DateTime?               @default(now()) @updatedAt
+  deletedAt              DateTime?
+
+  senderId               String
+  sender                 User                    @relation(fields: [senderId], references: [id])
+  messageId              String
+  message                Message                 @relation(fields: [messageId], references: [id])
+}
+
+model Reaction {
+  id                     Int                     @default(autoincrement()) @id
+  value                  String
+  userId                 String
+  user                   User                    @relation(fields: [userId], references: [id])
+  messageId              String
+  message                Message                 @relation(fields: [messageId], references: [id])
+  replyId                Int
+  reply                  Reply                   @relation(fields: [replyId], references: [id])
+}
```


